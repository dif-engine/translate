# BLUISH CODER: 安全なプログラミング言語を使って heartbleed を防ぐには

(元記事は http://bluishcoder.co.nz/2014/04/11/preventing-heartbleed-bugs-with-safe-languages.html です)

OpenSSL の [heartbleed バグ](http://heartbleed.com/) はインターネット全体に多大なダメージを与えました。
このバグはとても単純で、C言語のような安全でない言語を使ったプログラミングがなぜ問題になるのかを示す教科書的な例です。

より安全なシステムプログラミング言語がこのバグを防止できるかどうかの実験として、
今回の問題の関数を [ATS プログラミング言語](http://www.ats-lang.org/) を用いて書き直してみます。
私は以前、[より安全なC言語として ATS について紹介しました](http://bluishcoder.co.nz/tags/ats)。
この記事では現実のテストケースを取り扱います。
ここでは ATS2 と呼ばれる ATS の最新版を使っています。

ATS はC言語コードにコンパイルします。
生成された関数インターフェイスは既存のC言語関数に厳密にマッチし、さらにC言語から呼び出すこともできます。
OpenSSL の dtls1_process_heartbeat と tls1_process_heartbeat 関数を ATS 言語を使って置換するために、私はこの機能を使いました。
これら2つの関数は heartbleed バグを修正するためにパッチがあてれた箇所です。

私が取ったアプローチは
[ATS メーリングリストでの John Skaller による次の発言](http://sourceforge.net/p/ats-lang/mailman/message/32204291/)
とよく似たものです:

```
ATS は基本的により良い型システムを持つC言語だ。
恐しい依存型なしに、かなり低レベルなC言語コードを書くとしよう。
そしてC言語のコードが手に入る。
もし君がミスをしていたらクラッシュするだろう。

もし高レベルな型システムを使えば、コーディングにはより多くの作業とより多くの考慮が要求されることになる。
でも君はプログラムの正確さについてより強い保証が得られるんだ。
それも OCaml や Haskell を使うよりもさらに強い保証だ。
さらに実行時の検査を省略することで、君はC言語より *より良い* 効率を望むことだってできる。
これらは型システムによる正確さの証明によっている。
クリティカルなソフトウェアにおいて、君のコードの 50% 以上はそのような証明だと思う。
ひょっとすると君の能力の 90% はアルゴリズムを実装するのではなく、そのような証明できることを構築することに費やされているかもしれない。
これはパラダイムシフトだよ。
```

xxx
